{% extends 'base.twig' %}

{% block main %}
	<div class="subscriber-dashboard-edit-section">
		<div class="container">
			<div class="row">
				<div
					class="col-md-10 offset-md-1 col-lg-8 offset-lg-2">
					<!-- Back Navigation -->
					<div class="back-navigation">
						<a href="/subscriber-dashboard/" class="back-btn">
							<span class="back-arrow">‚Üê</span>
							<span class="back-text">Back to Dashboard</span>
						</a>
					</div>

					<div class="subscriber-dashboard-edit-form">
						<h2>Edit Your Wedding Page</h2>
						<p class="form-subtitle">Customize your beautiful wedding invitation with ease</p>
						{% if edit_message %}
							<div class="alert alert-info">{{ edit_message }}</div>
						{% endif %}
						<form method="post" action="" enctype="multipart/form-data">
							<input type="hidden" name="subscriber_page_nonce" value="{{ edit_nonce }}">
							<input
							type="hidden" name="subscriber_page_update" value="1">

							<!-- Template Selection Section -->
							<div class="form-section template-section">
								<h3>‚ú® Page Template</h3>
								<div class="form-group">
									<label for="elementor_template_id">Choose a Template</label>
									<select id="elementor_template_id" name="elementor_template_id" class="form-control">
										<option value="">-- No Change --</option>
										{% for tpl in elementor_templates %}
											<option value="{{ tpl.ID }}" {% if tpl.ID == current_template_id %} selected {% endif %}>{{ tpl.post_title }}</option>
										{% endfor %}
									</select>
									<small class="form-text text-muted">Select a template to apply its design to your page. Choosing "No Change" will keep your current design.</small>
								</div>
							</div>

							<!-- Page Settings Section -->
							<div class="form-section settings-section">
								<h3>‚öôÔ∏è Page Settings</h3>
								<div class="form-group">
									<label for="page_slug">Page URL Slug</label>
									<div class="input-group">
										<span class="input-group-text">{{ site.url }}/</span>
										<input type="text" id="page_slug" name="page_slug" class="form-control" value="{{ edit_slug }}" required pattern="[a-zA-Z0-9\-]+">
									</div>
									<small class="form-text text-muted">Only letters, numbers, and dashes allowed. Example:
										<code>member-john</code>
									</small>
								</div>
							</div>

							<!-- ACF Fields Section -->
							{% if has_acf_fields %}
								<div class="form-section content-section">
									<h3>üíù Page Content Fields</h3>
									<p class="section-description">Customize the content of your page using the fields below.</p>

									{% for group in acf_fields.field_groups %}
										<div class="acf-field-group">
											<h4>{{ group.title }}</h4>
											{% for field in group.fields %}
												{% if field.editable %}
													<div class="form-group acf-field" data-field-type="{{ field.type }}">
														<label for="{{ field.name }}">{{ field.label }}
															{% if field.required %}
																<span class="required">*</span>
															{% endif %}
														</label>

														{% if field.instructions %}
															<p class="field-instructions">{{ field.instructions }}</p>
														{% endif %}

														{% include 'partials/acf-field-types/' ~ field.type|lower ~ '.twig' with {
															field: field,
															config: field.config
														} %}
													</div>
												{% endif %}
											{% endfor %}
										</div>
									{% endfor %}
								</div>
							{% endif %}

							<div class="form-actions">
								<button type="submit" class="btn btn-success">
									üíæ Save Changes
								</button>
								<a href="{{ subscriber_page_url }}" class="btn btn-secondary" target="_blank">
									üëÄ View Your Page
								</a>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block afterMain %}
	<style>
		/* Modern Harawara-inspired Design */
		.subscriber-dashboard-edit-section {
			min-height: 100vh;
			background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
			padding: 40px 0 80px;
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
		}

		/* Back Navigation */
		.back-navigation {
			margin-bottom: 32px;
			padding-top: 80px;
		}

		.back-btn {
			display: inline-flex;
			align-items: center;
			gap: 12px;
			padding: 12px 20px;
			background: rgba(255, 255, 255, 0.9);
			border: 2px solid #e2e8f0;
			border-radius: 16px;
			color: #64748b;
			text-decoration: none;
			font-weight: 500;
			font-size: 0.95rem;
			transition: all 0.3s ease;
			backdrop-filter: blur(10px);
			box-shadow: 0 4px 16px rgba(0, 0, 0, 0.04);
		}

		.back-btn:hover {
			background: #ffffff;
			border-color: #cbd5e1;
			color: #374151;
			text-decoration: none;
			transform: translateX(-4px);
			box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
		}

		.back-arrow {
			font-size: 1.25rem;
			transition: transform 0.3s ease;
		}

		.back-btn:hover .back-arrow {
			transform: translateX(-2px);
		}

		.back-text {
			font-weight: 500;
		}

		.subscriber-dashboard-edit-form {
			background: #ffffff;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
			border-radius: 24px;
			padding: 48px 40px 56px;
			margin-bottom: 40px;
			border: 1px solid rgba(255, 255, 255, 0.8);
			backdrop-filter: blur(10px);
		}

		.subscriber-dashboard-edit-form h2 {
			color: #1a1a1a;
			margin-bottom: 8px;
			font-size: 2rem;
			font-weight: 700;
			letter-spacing: -0.02em;
			text-align: center;
		}

		.form-subtitle {
			text-align: center;
			color: #64748b;
			font-size: 1.1rem;
			margin-bottom: 48px;
			font-weight: 400;
		}

		.form-section {
			margin-bottom: 48px;
			padding: 32px;
			background: #ffffff;
			border: 1px solid #e2e8f0;
			border-radius: 16px;
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
			transition: all 0.3s ease;
		}

		.form-section:hover {
			box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
			transform: translateY(-2px);
		}

		.form-section h3 {
			color: #1e293b;
			margin-bottom: 24px;
			font-size: 1.5rem;
			font-weight: 600;
			display: flex;
			align-items: center;
			gap: 12px;
		}

		.form-section h3:before {
			content: '';
			width: 4px;
			height: 24px;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			border-radius: 2px;
			margin-right: 8px;
		}

		.section-description {
			color: #64748b;
			margin-bottom: 28px;
			font-size: 1rem;
			line-height: 1.6;
			font-style: normal;
		}

		.acf-field-group {
			margin-bottom: 32px;
			padding: 24px;
			background: #f8fafc;
			border-radius: 12px;
			border: 1px solid #e2e8f0;
		}

		.acf-field-group h4 {
			color: #374151;
			margin-bottom: 20px;
			font-size: 1.25rem;
			font-weight: 600;
		}

		.form-group {
			margin-bottom: 24px;
		}

		.form-group label {
			display: block;
			margin-bottom: 8px;
			color: #374151;
			font-weight: 500;
			font-size: 0.95rem;
		}

		.input-group {
			position: relative;
			display: flex;
			align-items: stretch;
		}

		.input-group-text {
			background: #f1f5f9;
			border: 2px solid #e2e8f0;
			border-right: none;
			border-radius: 12px 0 0 12px;
			padding: 16px 20px;
			color: #64748b;
			font-weight: 500;
			font-size: 0.9rem;
		}

		input[type="text"],
		input[type="email"],
		input[type="url"],
		input[type="number"],
		input[type="file"],
		textarea,
		select {
			width: 100%;
			border: 2px solid #e2e8f0;
			border-radius: 12px;
			padding: 16px 20px;
			font-size: 1rem;
			background: #ffffff;
			transition: all 0.3s ease;
			outline: none;
		}

		.input-group input[type="text"] {
			border-radius: 0 12px 12px 0;
			border-left: none;
		}

		input:focus,
		textarea:focus,
		select:focus {
			border-color: #667eea;
			box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
		}

		select {
			cursor: pointer;
		}

		.field-instructions {
			font-size: 0.875rem;
			color: #64748b;
			margin-top: 8px;
			line-height: 1.5;
		}

		.required {
			color: #ef4444;
			margin-left: 4px;
		}

		/* Modern Button Styles */
		.form-actions {
			margin-top: 48px;
			padding-top: 32px;
			border-top: 1px solid #e2e8f0;
			display: flex;
			gap: 16px;
			justify-content: center;
			align-items: center;
		}

		.btn {
			padding: 16px 32px;
			border-radius: 12px;
			font-weight: 600;
			font-size: 1rem;
			text-decoration: none;
			border: none;
			cursor: pointer;
			transition: all 0.3s ease;
			display: inline-flex;
			align-items: center;
			gap: 8px;
		}

		.btn-success {
			background: linear-gradient(135deg, #10b981 0%, #059669 100%);
			color: white;
			box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
		}

		.btn-success:hover {
			transform: translateY(-2px);
			box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
		}

		.btn-secondary {
			background: #ffffff;
			color: #64748b;
			border: 2px solid #e2e8f0;
		}

		.btn-secondary:hover {
			background: #f8fafc;
			border-color: #cbd5e1;
			transform: translateY(-1px);
		}

		/* Alert Styles */
		.alert {
			padding: 16px 20px;
			border-radius: 12px;
			margin-bottom: 24px;
			border: none;
		}

		.alert-info {
			background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
			color: #1e40af;
			border-left: 4px solid #3b82f6;
		}

		/* File Upload Styles */
		.file-field-container {
			position: relative;
		}

		input[type="file"] {
			border: 2px dashed #e2e8f0;
			border-radius: 12px;
			padding: 32px 20px;
			text-align: center;
			background: #f8fafc;
			transition: all 0.3s ease;
		}

		input[type="file"]:hover {
			border-color: #cbd5e1;
			background: #f1f5f9;
		}

		input[type="file"]:focus {
			border-color: #667eea;
			background: #ffffff;
		}

		.file-preview {
			margin-top: 16px;
			padding: 16px;
			background: #f8fafc;
			border-radius: 12px;
			border: 1px solid #e2e8f0;
		}

		.current-file-text {
			margin-bottom: 12px;
		}

		.form-check {
			display: flex;
			align-items: center;
			gap: 8px;
			cursor: pointer;
		}

		.form-check-input {
			margin: 0;
			accent-color: #667eea;
		}

		/* Gallery Styles */
		.gallery-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
			gap: 16px;
			margin-top: 16px;
		}

		.gallery-item {
			background: #ffffff;
			border-radius: 12px;
			overflow: hidden;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
			transition: all 0.3s ease;
		}

		.gallery-item:hover {
			transform: translateY(-2px);
			box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
		}

		.gallery-item img {
			width: 100%;
			height: 100px;
			object-fit: cover;
		}

		.gallery-item-info {
			padding: 12px;
		}

		.gallery-item-info small {
			display: block;
			margin-bottom: 8px;
			color: #64748b;
			font-size: 0.8rem;
		}

		/* Checkbox and Radio Styles */
		.checkbox-item,
		.radio-item {
			display: flex;
			align-items: center;
			gap: 12px;
			margin-bottom: 12px;
			padding: 12px 16px;
			background: #f8fafc;
			border-radius: 8px;
			cursor: pointer;
			transition: all 0.2s ease;
		}

		.checkbox-item:hover,
		.radio-item:hover {
			background: #f1f5f9;
		}

		/* Color Picker */
		input[type="color"] {
			width: 60px;
			height: 60px;
			padding: 0;
			border: 4px solid #ffffff;
			border-radius: 50%;
			cursor: pointer;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
		}

		/* Responsive Design */
		@media(max-width: 768px) {
			.back-navigation {
				margin: 0 16px 24px;
			}

			.back-btn {
				padding: 10px 16px;
				font-size: 0.9rem;
				gap: 10px;
			}

			.subscriber-dashboard-edit-form {
				padding: 32px 24px 40px;
				margin: 0 16px 32px;
				border-radius: 20px;
			}

			.form-section {
				padding: 24px 20px;
			}

			.form-actions {
				flex-direction: column;
			}

			.btn {
				width: 100%;
				justify-content: center;
			}
		}

		/* Loading States */
		.btn:disabled {
			opacity: 0.6;
			cursor: not-allowed;
			transform: none !important;
		}

		/* Enhanced Focus States */
		*:focus {
			outline: none;
		}

		/* Smooth Animations */
		* {
			transition: all 0.2s ease;
		}
	</style>
{% endblock %}
